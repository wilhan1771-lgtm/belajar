<!doctype html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Receiving List</title>

<style>
body {
  font-family: 'Segoe UI', Arial, sans-serif;
  background: #f1f5f9;
  margin: 0;
  padding: 30px;
}

.container {
  max-width: 1200px;
  margin: auto;
}

.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}

h2 {
  margin:0;
}

.card {
  background:white;
  border-radius:16px;
  padding:20px;
  box-shadow: 0 10px 25px rgba(0,0,0,0.05);
  margin-bottom:20px;
}

.form-grid {
  display:grid;
  grid-template-columns: repeat(auto-fit, minmax(180px,1fr));
  gap:15px;
  align-items:end;
}

label {
  font-size:12px;
  color:#6b7280;
  font-weight:600;
}

input, select {
  width:100%;
  padding:8px 2px;
  border-radius:7px;
  border:1px solid #d1d5db;
  font-size:14px;
}

input:focus, select:focus {
  outline:none;
  border-color:#2563eb;
}

.btn {
  padding:9px 14px;
  border-radius:10px;
  border:none;
  font-weight:600;
  cursor:pointer;
  text-decoration:none;
  display:inline-block;
}

.btn-primary {
  background:#2563eb;
  color:white;
}

.btn-primary:hover {
  background:#1e40af;
}

.btn-secondary {
  background:#e0f2fe;
  color:#0369a1;
}

.summary {
  font-size:14px;
  font-weight:600;
}

table {
  width:100%;
  border-collapse:collapse;
}

thead {
  background:#f8fafc;
}

th, td {
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  font-size:14px;
}

th {
  text-align:left;
  font-weight:600;
}

tbody tr:hover {
  background:#f9fafb;
}

.actions {
  display:flex;
  gap:8px;
}
</style>
</head>

<body>
<div class="container">

  <div class="header">
    <h2>Receiving List</h2>
    <a class="btn btn-secondary" href="/dashboard">Dashboard</a>
  </div>

  <!-- FILTER CARD -->
  <div class="card">
    <form method="get" action="/receiving/list">
      <div class="form-grid">

        <div>
          <label>Tanggal Mulai</label>
          <input type="date" name="start" value="{{ start or '' }}">
        </div>

        <div>
          <label>Tanggal Akhir</label>
          <input type="date" name="end" value="{{ end or '' }}">
        </div>

        <div>
          <label>Supplier</label>
          <select name="supplier" id="supplier">
            <option value="">-- Semua Supplier --</option>
          </select>
        </div>

        <div>
          <label>Jenis Udang</label>
          <select name="jenis" id="jenis">
            <option value="">-- Semua Jenis --</option>
          </select>
        </div>

        <div>
          <button type="submit" class="btn btn-primary">Search</button>
          <a href="/receiving/list" class="btn btn-secondary">Reset</a>
        </div>

      </div>
    </form>
  </div>

  <!-- SUMMARY -->
  <div class="card summary">
    Total Berat (kg): {{ "%.2f"|format(total_berat or 0) }}
  </div>

  <!-- TABLE -->
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Tanggal</th>
          <th>ID</th>
          <th>Supplier</th>
          <th>Jenis</th>
          <th>Size</th>
          <th>Total Netto (kg)</th>
          <th>MENU</th>
        </tr>
      </thead>
      <tbody>

        {% if not rows %}
        <tr>
          <td colspan="8">Belum ada data receiving.</td>
        </tr>
        {% endif %}

        {% for r in rows %}
        <tr>
          <td>{{ r.tanggal }}</td>
          <td>{{ r.id }}</td>
          <td>{{ r.supplier }}</td>
          <td>{{ r["jenis"] or "-" }}</td>
          <td>{{ r["size_display"] or "-" }}</td>
          <td>{{ "%.2f"|format(r["total_netto"] or 0) }}</td>

          <td>
            <div class="actions">
              <a class="btn btn-secondary" href="/receiving/{{ r.id }}">Detail</a>
            </div>
          </td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>

</div>

<script>
async function loadSuppliers() {
  const sel = document.getElementById("supplier");
  const params = new URLSearchParams(window.location.search);
  const selected = (params.get("supplier") || "").trim().toLowerCase();

  try {
    const res = await fetch("/master/suppliers");
    const json = await res.json();
    if (!json.ok) return;

    json.data.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r.nama;
      opt.textContent = r.nama;
      if (r.nama.toLowerCase() === selected) opt.selected = true;
      sel.appendChild(opt);
    });
  } catch(e){}
}

async function loadJenis() {
  const sel = document.getElementById("jenis");
  const params = new URLSearchParams(window.location.search);
  const selected = (params.get("jenis") || "").trim().toLowerCase();

  try {
    const res = await fetch("/master/jenis");
    const json = await res.json();
    if (!json.ok) return;

    json.data.forEach(r => {
      const opt = document.createElement("option");
      opt.value = r.nama;
      opt.textContent = r.nama;
      if (r.nama.toLowerCase() === selected) opt.selected = true;
      sel.appendChild(opt);
    });
  } catch(e){}
}

loadSuppliers();
loadJenis();
</script>

</body>
</html>
